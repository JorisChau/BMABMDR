covar
length(covar)
if(min(dose) == 0){
plot.labs = dose
plot.breaks = c(log10(min(dose[dose!=0])/4), log10(dose[2:length(dose)]))
}else{
plot.labs = c(0, dose)
plot.breaks = c(log10(min(dose[dose!=0])/4), log10(dose))
}
plot.labs
plot.breaks
model_pars <- get('x')[[paste0('par',model_name)]]
if(increasing == TRUE){
DRM <- get(paste0('DRM.', model_name, 'I'))
}  else{
DRM <- get(paste0('DRM.', model_name, 'D'))
}
FLBMD$summary
1:length(covar)
for(i in 1:length(covar)){
pars <- c('par1[1]',
paste0('par2[',i,']'),
'par3',
paste0('par4[',i,']'))
if(grepl('_LN',model_name)){
temp1 <- c(temp1, exp(DRM(par = model_pars[pars], (10^(log10(seq(ifelse(min(x$data$x) == 0, min(x$data$x[x$data$x != 0])/4, min(x$data$x)), maxDose, 0.01))))/maxDose, x$q, x$shift)))
}else{
temp1 <- c(temp1, DRM(par = model_pars[pars], (10^(log10(seq(ifelse(min(x$data$x) == 0, min(x$data$x[x$data$x != 0])/4, min(x$data$x)), maxDose, 0.01))))/maxDose, x$q, x$shift))
}
}
pars
head(temp1)
temp1
dataTemp <- data.frame(x = log10(seq(ifelse(min(x$data$x) == 0, min(x$data$x[x$data$x != 0])/4, min(x$data$x)), maxDose, 0.01)),
y = temp1,
cov = rep(covar, each = length(log10(seq(ifelse(min(x$data$x) == 0, min(x$data$x[x$data$x != 0])/4, min(x$data$x)), maxDose, 0.01)))))
p <- ggplot() + geom_point(data = x$data, aes(x = x2, y = geom.y, colour = cov)) +
geom_line(data = dataTemp, aes(x = x, y = y, colour = cov))          +
geom_errorbar(data = x$data, mapping = aes(x = x2, ymin = geom.y - geom.s, ymax = geom.y + geom.s, colour = cov),
size = 1, width = NA, linetype = 'dotted')
p
ggplot() + geom_point(data = x$data, aes(x = x2, y = geom.y, colour = cov)) +
geom_line(data = dataTemp, aes(x = x, y = y, colour = cov))          +
geom_errorbar(data = x$data, mapping = aes(x = x2, ymin = geom.y - geom.s, ymax = geom.y + geom.s, colour = cov),
size = 1, width = NA, linetype = 'full')
ggplot() + geom_point(data = x$data, aes(x = x2, y = geom.y, colour = cov)) +
geom_line(data = dataTemp, aes(x = x, y = y, colour = cov))          +
geom_errorbar(data = x$data, mapping = aes(x = x2, ymin = geom.y - geom.s, ymax = geom.y + geom.s, colour = cov),
size = 1, width = NA, linetype = 'solid')
x$data
ggplot() + geom_point(data = x$data, aes(x = x2, y = geom.y, colour = cov)) +
geom_line(data = dataTemp, aes(x = x, y = y, colour = cov))          +
geom_errorbar(data = x$data, mapping = aes(x = x2, ymin = geom.y - geom.s, ymax = geom.y + geom.s, colour = cov),
size = 1, width = NA, linetype = 'dashed')
plot.labs
plot.breaks
?scale_x_continuous
ggplot() + geom_point(data = x$data, aes(x = x2, y = geom.y, colour = cov)) +
geom_line(data = dataTemp, aes(x = x, y = y, colour = cov))          +
geom_errorbar(data = x$data, mapping = aes(x = x2, ymin = geom.y - geom.s, ymax = geom.y + geom.s, colour = cov),
size = 1, width = NA, linetype = 'dashed') +
scale_x_continuous(trans = 'identity', labels = plot.labs, breaks = plot.breaks)
source('R/plot_model_fit.R')
data <- read.csv('~/BBMD/FINAL CODE/RatStudy.csv', header = T)
data
summ.data <- data.frame(x = data$Dose,
y = data$MeanBW,
s = data$SdBW,
n = data$N,
cov = data$Sex)
summ.data
q = 0.05
prior.weights = c(rep(1,4), rep(0,12))
FLBMD <- full.laplace_MA_Cov(summ.data,
sumstats = T,
sd = T, # option not used for Quantal data
q = q,
prior.d = 'N11',
extended = T,
ndraws = 30000,
seed = 123,
pvec = c(0.05, 0.5, 0.95),
prior.weights = prior.weights)
FLBMD$MA
FLBMD$summary
basic.plot(FLBMD, 'E4_N', increasing = F)
data=read.csv('~/BBMD/FINAL CODE/TESTING/test_data.csv', header = T, sep = ';')
summ.data <- data.frame(x = data$Dose,
y = data$Mean,
s = data$SD,
n = data$N,
cov = data$group)
summ.data
x$data
log(x$data$geom.s)
log(x$data$geom.y)
?geom_errobar
??geom_errorbar
ggplot() + geom_point(data = x$data, aes(x = x2, y = geom.y, colour = cov)) +
geom_line(data = dataTemp, aes(x = x, y = y, colour = cov))          +
geom_errorbar(data = x$data, mapping = aes(x = x2, ymin = geom.y - geom.s, ymax = geom.y + geom.s, colour = cov),
size = 1, width = NA, linetype = 'dashed') +
scale_x_continuous(trans = 'identity', labels = plot.labs, breaks = plot.breaks, position = position_dodge())
ggplot() + geom_point(data = x$data, aes(x = x2, y = geom.y, colour = cov)) +
geom_line(data = dataTemp, aes(x = x, y = y, colour = cov))          +
geom_errorbar(data = x$data, mapping = aes(x = x2, ymin = geom.y - geom.s, ymax = geom.y + geom.s, colour = cov),
size = 1, width = NA, linetype = 'dashed', position = position_dodge()) +
scale_x_continuous(trans = 'identity', labels = plot.labs, breaks = plot.breaks)
ggplot() + geom_point(data = x$data, aes(x = x2, y = geom.y, colour = cov), position = position_dodge()) +
geom_line(data = dataTemp, aes(x = x, y = y, colour = cov))          +
geom_errorbar(data = x$data, mapping = aes(x = x2, ymin = geom.y - geom.s, ymax = geom.y + geom.s, colour = cov),
size = 1, width = NA, linetype = 'dashed', position = position_dodge()) +
scale_x_continuous(trans = 'identity', labels = plot.labs, breaks = plot.breaks)
ggplot() + geom_point(data = x$data, aes(x = x2, y = geom.y, colour = cov), position = position_dodge(width=0.9)) +
geom_line(data = dataTemp, aes(x = x, y = y, colour = cov))          +
geom_errorbar(data = x$data, mapping = aes(x = x2, ymin = geom.y - geom.s, ymax = geom.y + geom.s, colour = cov),
size = 1, width = NA, linetype = 'dashed', position = position_dodge(width=0.9)) +
scale_x_continuous(trans = 'identity', labels = plot.labs, breaks = plot.breaks)
ggplot() + geom_point(data = x$data, aes(x = x2, y = geom.y, colour = cov), position = position_dodge(width=0.1)) +
geom_line(data = dataTemp, aes(x = x, y = y, colour = cov))          +
geom_errorbar(data = x$data, mapping = aes(x = x2, ymin = geom.y - geom.s, ymax = geom.y + geom.s, colour = cov),
size = 1, width = NA, linetype = 'dashed', position = position_dodge(width=0.1)) +
scale_x_continuous(trans = 'identity', labels = plot.labs, breaks = plot.breaks)
ggplot() + geom_point(data = x$data, aes(x = x2, y = geom.y, colour = cov), position = position_dodge(width=0.1)) +
geom_line(data = dataTemp, aes(x = x, y = y, colour = cov))          +
geom_errorbar(data = x$data, mapping = aes(x = x2, ymin = geom.y - geom.s, ymax = geom.y + geom.s, colour = cov),
size = 1, width = NA, linetype = 'dotted', position = position_dodge(width=0.1)) +
scale_x_continuous(trans = 'identity', labels = plot.labs, breaks = plot.breaks)
ggplot() + geom_point(data = x$data, aes(x = x2, y = geom.y, colour = cov), position = position_dodge(width=0.2)) +
geom_line(data = dataTemp, aes(x = x, y = y, colour = cov))          +
geom_errorbar(data = x$data, mapping = aes(x = x2, ymin = geom.y - geom.s, ymax = geom.y + geom.s, colour = cov),
size = 1, width = NA, linetype = 'dotted', position = position_dodge(width=0.2)) +
scale_x_continuous(trans = 'identity', labels = plot.labs, breaks = plot.breaks)
ggplot() + geom_point(data = x$data, aes(x = x2, y = geom.y, colour = cov)) + #, position = position_dodge(width=0.2)) +
geom_line(data = dataTemp, aes(x = x, y = y, colour = cov))          +
geom_errorbar(data = x$data, mapping = aes(x = x2, ymin = geom.y - geom.s, ymax = geom.y + geom.s, colour = cov),
size = 1, width = NA, linetype = 'dotted') + #, position = position_dodge(width=0.2)) +
scale_x_continuous(trans = 'identity', labels = plot.labs, breaks = plot.breaks)
summ.data
q=0.20
ndr=30000
nrch=3;nriter=3000;wu=1000;dl=0.8;trd=10;sd=123;
pw <- c(rep(0,8), rep(1,4), rep(0,4))
FLBMD2 <- full.laplace_MA_Cov(summ.data,ndraws=ndr,seed=sd,
pvec = c(0.05, 0.5, 0.95),
prior.weights = pw)
ggplot() + geom_point(data = x$data, aes(x = x2, y = geom.y, colour = cov)) + #, position = position_dodge(width=0.2)) +
geom_line(data = dataTemp, aes(x = x, y = y, colour = cov))          +
geom_errorbar(data = x$data, mapping = aes(x = x2, ymin = geom.y - geom.s, ymax = geom.y + geom.s, colour = cov),
size = 1, width = NA, linetype = 'dotted') + #, position = position_dodge(width=0.2)) +
scale_x_continuous(trans = 'identity', labels = plot.labs, breaks = plot.breaks)
summ.data
x$data
NtoLN(x$data$y, x$data$s)[1:dim(x$data)[1]]
NtoLN(x$data$y, x$data$s)[(dim(x$data)[1]+1):(2*dim(x$data)[1])]
log(NtoLN(x$data$y, x$data$s)[(dim(x$data)[1]+1):(2*dim(x$data)[1])])
??geom_point
ggplot() + geom_point(data = x$data, aes(x = x2, y = geom.y, colour = cov)) + #, position = position_dodge(width=0.2)) +
geom_line(data = dataTemp, aes(x = x, y = y, colour = cov))          +
geom_point(data = x$data, aes(x = x2, y = geom.y + geom.s, colour = cov), shape = 24) +
# geom_errorbar(data = x$data, mapping = aes(x = x2, ymin = geom.y - geom.s, ymax = geom.y + geom.s, colour = cov),
#               size = 1, width = NA, linetype = 'dotted') + #, position = position_dodge(width=0.2)) +
scale_x_continuous(trans = 'identity', labels = plot.labs, breaks = plot.breaks)
ggplot() + geom_point(data = x$data, aes(x = x2, y = geom.y, colour = cov)) + #, position = position_dodge(width=0.2)) +
geom_line(data = dataTemp, aes(x = x, y = y, colour = cov))          +
geom_point(data = x$data, aes(x = x2, y = geom.y + geom.s, colour = cov), shape = 24, fill = cov) +
# geom_errorbar(data = x$data, mapping = aes(x = x2, ymin = geom.y - geom.s, ymax = geom.y + geom.s, colour = cov),
#               size = 1, width = NA, linetype = 'dotted') + #, position = position_dodge(width=0.2)) +
scale_x_continuous(trans = 'identity', labels = plot.labs, breaks = plot.breaks)
ggplot() + geom_point(data = x$data, aes(x = x2, y = geom.y, colour = cov)) + #, position = position_dodge(width=0.2)) +
geom_line(data = dataTemp, aes(x = x, y = y, colour = cov))          +
geom_point(data = x$data, aes(x = x2, y = geom.y + geom.s, colour = cov, fill = cov), shape = 24) +
# geom_errorbar(data = x$data, mapping = aes(x = x2, ymin = geom.y - geom.s, ymax = geom.y + geom.s, colour = cov),
#               size = 1, width = NA, linetype = 'dotted') + #, position = position_dodge(width=0.2)) +
scale_x_continuous(trans = 'identity', labels = plot.labs, breaks = plot.breaks)
ggplot() + geom_point(data = x$data, aes(x = x2, y = geom.y, colour = cov)) + #, position = position_dodge(width=0.2)) +
geom_line(data = dataTemp, aes(x = x, y = y, colour = cov))          +
geom_point(data = x$data, aes(x = x2, y = geom.y + geom.s, colour = cov, fill = cov), shape = 24) +
geom_point(data = x$data, aes(x = x2, y = geom.y - geom.s, colour = cov, fill = cov), shape = 25) +
# geom_errorbar(data = x$data, mapping = aes(x = x2, ymin = geom.y - geom.s, ymax = geom.y + geom.s, colour = cov),
#               size = 1, width = NA, linetype = 'dotted') + #, position = position_dodge(width=0.2)) +
scale_x_continuous(trans = 'identity', labels = plot.labs, breaks = plot.breaks)
ggplot() + geom_point(data = x$data, aes(x = x2, y = geom.y, colour = cov)) + #, position = position_dodge(width=0.2)) +
geom_line(data = dataTemp, aes(x = x, y = y, colour = cov))          +
geom_point(data = x$data, aes(x = x2, y = geom.y + geom.s, colour = cov, fill = cov), shape = 25) +
geom_point(data = x$data, aes(x = x2, y = geom.y - geom.s, colour = cov, fill = cov), shape = 24) +
# geom_errorbar(data = x$data, mapping = aes(x = x2, ymin = geom.y - geom.s, ymax = geom.y + geom.s, colour = cov),
#               size = 1, width = NA, linetype = 'dotted') + #, position = position_dodge(width=0.2)) +
scale_x_continuous(trans = 'identity', labels = plot.labs, breaks = plot.breaks)
FLBMD$MA
x$MA
ys = rnorm(100, mean = 5, sd = 0.3)
summary(ys)
sd(ys)
mean(ys)
prod(ys)^(1/100)
gm = prod(ys)^(1/100)
gs = exp(sqrt((sum(log(ys/gm))^2)/100))
gs
exp(mean(ys)+(var(ys)/2))
log(exp(mean(ys)+(var(ys)/2)))
v = var(ys)
v
m = mean(ys)
m
(exp(v)-1) * exp(2*m + v)
log((exp(v)-1) * exp(2*m + v))
###################
data=read.csv('~/BBMD/FINAL CODE/TESTING/test_data.csv', header = T, sep = ';')
summ.data <- data.frame(x = data$Dose,
y = data$Mean,
s = data$SD,
n = data$N,
cov = data$group)
summ.data
q=0.20
ndr=30000
nrch=3;nriter=3000;wu=1000;dl=0.8;trd=10;sd=123;
# pw <- c(rep(0,8), rep(1,4), rep(0,4))
FLBMD2 <- full.laplace_MA_Cov(summ.data,ndraws=ndr,seed=sd,
pvec = c(0.05, 0.5, 0.95),
prior.weights = rep(1,16))
FLBMD2$MA
# pw <- c(rep(0,8), rep(1,4), rep(0,4))
FLBMD2 <- full.laplace_MA_Cov(summ.data,ndraws=ndr,seed=sd,
pvec = c(0.05, 0.5, 0.95),q=0.2,
prior.weights = rep(1,16))
FLBMD2$MA
FLBMD2$summary
basic.plot(FLBMD2, 'H4_LN', T)
source('R/plot_model_fit.R')
basic.plot(FLBMD2, 'H4_LN', T)
basic.plot(FLBMD2, 'IE4_LN', T)
basic.plot(FLBMD2, 'E4_N', T)
basic.plot(FLBMD2, 'H4_LN', T)
basic.plot(FLBMD2, 'IE4_LN', T)
data <- read.csv('~/BBMD/FINAL CODE/RatStudy.csv', header = T)
data
summ.data <- data.frame(x = data$Dose,
y = data$MeanBW,
s = data$SdBW,
n = data$N,
cov = data$Sex)
summ.data
q = 0.05
prior.weights = c(rep(1,4), rep(0,12))
FLBMD <- full.laplace_MA_Cov(summ.data,
sumstats = T,
sd = T, # option not used for Quantal data
q = q,
prior.d = 'N11',
extended = T,
ndraws = 30000,
seed = 123,
pvec = c(0.05, 0.5, 0.95),
prior.weights = prior.weights)
FLBMD$MA
FLBMD$summary
basic.plot(FLBMD, 'E4_N', increasing = F)
summ.data
FLBMD$summary
FLBMD$MA
x
x$data
ggplot() + geom_point(data = x$data, aes(x = x2, y = geom.y, colour = cov)) +
geom_line(data = dataTemp, aes(x = x, y = y)) +
geom_point(data = x$data, aes(x = x2, y = geom.y + geom.s, colour = cov, fill = cov), shape = 25) +
geom_point(data = x$data, aes(x = x2, y = geom.y - geom.s, colour = cov, fill = cov), shape = 24) +
# geom_errorbar(data = x$data, mapping = aes(x = x2, ymin = geom.y - geom.s, ymax = geom.y + geom.s, colour = cov),
#               size = 1, width = NA, linetype = 'dashed') +
scale_x_continuous(trans = 'identity', labels = plot.labs, breaks = plot.breaks)
x = FLBMD
model_name = 'E4_N'
increasing = F
covar <- as.factor(unique(x$data[,5]))
temp <- temp1 <- temp2 <- temp3 <- NULL
x$data$geom.y <- NtoLN(x$data$y, x$data$s)[1:dim(x$data)[1]]
x$data$geom.s <- NtoLN(x$data$y, x$data$s)[(dim(x$data)[1]+1):(2*dim(x$data)[1])]
maxDose <- x$maxDose
dose = unique(x$data$x)
x$data$x2 = ifelse(x$data$x == 0, log10(min(x$data$x[x$data$x != 0])/4), log10(x$data$x))
if(min(dose) == 0){
plot.labs = dose
plot.breaks = c(log10(min(dose[dose!=0])/4), log10(dose[2:length(dose)]))
}else{
plot.labs = c(0, dose)
plot.breaks = c(log10(min(dose[dose!=0])/4), log10(dose))
}
model_pars <- get('x')[[paste0('par',model_name)]]
if(increasing == TRUE){
DRM <- get(paste0('DRM.', model_name, 'I'))
}  else{
DRM <- get(paste0('DRM.', model_name, 'D'))
}
FLBMD$summary
for(i in 1:length(covar)){
pars <- c(paste0('par1[',i,']'),
paste0('par2[',i,']'),
'par3',
paste0('par4[',i,']')
)
if(grepl('_LN',model_name)){
temp2 <- c(temp2, exp(DRM(par = model_pars[pars], (10^(log10(seq(ifelse(min(x$data$x) == 0, min(x$data$x[x$data$x != 0])/4, min(x$data$x)), maxDose, 0.01))))/maxDose, x$q, x$shift)))
}else{
temp2 <- c(temp2, DRM(par = model_pars[pars], (10^(log10(seq(ifelse(min(x$data$x) == 0, min(x$data$x[x$data$x != 0])/4, min(x$data$x)), maxDose, 0.01))))/maxDose, x$q, x$shift))
}
}
dataTemp <- data.frame(x = log10(seq(ifelse(min(x$data$x) == 0, min(x$data$x[x$data$x != 0])/4, min(x$data$x)), maxDose, 0.01)),
y = temp2,
cov = rep(covar, each = length(log10(seq(ifelse(min(x$data$x) == 0, min(x$data$x[x$data$x != 0])/4, min(x$data$x)), maxDose, 0.01)))))
p <- ggplot() + geom_point(data = x$data, aes(x = x2, y = y, colour = cov)) +
geom_line(data = dataTemp, aes(x = x, y = y, colour = cov))+
geom_point(data = x$data, aes(x = x2, y = y + s, colour = cov, fill = cov), shape = 25) +
geom_point(data = x$data, aes(x = x2, y = y - s, colour = cov, fill = cov), shape = 24) +
# geom_errorbar(data = x$data, mapping = aes(x = x2, ymin = y - s, ymax = y + s, colour = cov),
#               size = 1, width = NA, linetype = 'dashed') +
scale_x_continuous(trans = 'identity', labels = plot.labs, breaks = plot.breaks)
p
ggplot() + geom_point(data = x$data, aes(x = x2, y = y, colour = cov)) +
geom_line(data = dataTemp, aes(x = x, y = y, colour = cov))+
geom_point(data = x$data, aes(x = x2, y = y + s, colour = cov, fill = cov), shape = 25) +
geom_point(data = x$data, aes(x = x2, y = y - s, colour = cov, fill = cov), shape = 24) +
# geom_errorbar(data = x$data, mapping = aes(x = x2, ymin = y - s, ymax = y + s, colour = cov),
#               size = 1, width = NA, linetype = 'dashed') +
scale_x_continuous(trans = 'identity', labels = plot.labs, breaks = plot.breaks)
packageVersion("ggplot2")
source('R/plot_model_fit.R')
basic.plot(FLBMD, 'E4_N', increasing = F)
x$data
covar <- as.factor(unique(x$data[,5]))
temp <- temp1 <- temp2 <- temp3 <- NULL
x$data$geom.y <- NtoLN(x$data$y, x$data$s)[1:dim(x$data)[1]]
x$data$geom.s <- NtoLN(x$data$y, x$data$s)[(dim(x$data)[1]+1):(2*dim(x$data)[1])]
maxDose <- x$maxDose
dose = unique(x$data$x)
x$data$x2 = ifelse(x$data$x == 0, log10(min(x$data$x[x$data$x != 0])/4), log10(x$data$x))
if(min(dose) == 0){
plot.labs = dose
plot.breaks = c(log10(min(dose[dose!=0])/4), log10(dose[2:length(dose)]))
}else{
plot.labs = c(0, dose)
plot.breaks = c(log10(min(dose[dose!=0])/4), log10(dose))
}
model_pars <- get('x')[[paste0('par',model_name)]]
if(increasing == TRUE){
DRM <- get(paste0('DRM.', model_name, 'I'))
}  else{
DRM <- get(paste0('DRM.', model_name, 'D'))
}
if(!is.na(x$summary$Submodel[x$summary$Model==model_name][1])){
if(x$summary$Submodel[x$summary$Model==model_name][1] == 'a_sigma2'){
for(i in 1:length(covar)){
pars <- c(paste0('par1[',i,']'),
'par2[1]',
'par3',
'par4[1]')
if(grepl('_LN',model_name)){
temp <- c(temp, exp(DRM(par = model_pars[pars], (10^(log10(seq(ifelse(min(x$data$x) == 0, min(x$data$x[x$data$x != 0])/4, min(x$data$x)), maxDose, 0.01))))/maxDose, x$q, x$shift)))
}else{
temp <- c(temp, DRM(par = model_pars[pars], (10^(log10(seq(ifelse(min(x$data$x) == 0, min(x$data$x[x$data$x != 0])/4, min(x$data$x)), maxDose, 0.01))))/maxDose, x$q, x$shift))
}
}
if(grepl('_LN',model_name)){
dataTemp <- data.frame(x = log10(seq(ifelse(min(x$data$x) == 0, min(x$data$x[x$data$x != 0])/4, min(x$data$x)), maxDose, 0.01)),
y = temp,
cov = rep(covar, each = length(log10(seq(ifelse(min(x$data$x) == 0, min(x$data$x[x$data$x != 0])/4, min(x$data$x)), maxDose, 0.01)))))
p <- ggplot() + geom_point(data = x$data, aes(x = x2, y = geom.y, colour = cov)) +
geom_line(data = dataTemp, aes(x = x, y = y, colour = cov)) +
geom_point(data = x$data, aes(x = x2, y = geom.y + geom.s, colour = cov, fill = cov), shape = 25) +
geom_point(data = x$data, aes(x = x2, y = geom.y - geom.s, colour = cov, fill = cov), shape = 24) +
# geom_errorbar(data = x$data, mapping = aes(x = x2, ymin = geom.y - geom.s, ymax = geom.y + geom.s, colour = cov),
#               size = 1, width = NA, linetype = 'dashed') +
scale_x_continuous(trans = 'identity', labels = plot.labs, breaks = plot.breaks)
}else{
dataTemp <- data.frame(x = log10(seq(ifelse(min(x$data$x) == 0, min(x$data$x[x$data$x != 0])/4, min(x$data$x)), maxDose, 0.01)),
y = temp,
cov = rep(covar, each = length(log10(seq(ifelse(min(x$data$x) == 0, min(x$data$x[x$data$x != 0])/4, min(x$data$x)), maxDose, 0.01)))))
p <- ggplot() + geom_point(data = x$data, aes(x = x2, y = y, colour = cov)) +
geom_line(data = dataTemp, aes(x = x, y = y, colour = cov)) +
geom_point(data = x$data, aes(x = x2, y = y + s, colour = cov, fill = cov), shape = 25) +
geom_point(data = x$data, aes(x = x2, y = y - s, colour = cov, fill = cov), shape = 24) +
# geom_errorbar(data = x$data, mapping = aes(x = x2, ymin = y - s, ymax = y + s, colour = cov),
#               size = 1, width = NA, linetype = 'dashed') +
scale_x_continuous(trans = 'identity', labels = plot.labs, breaks = plot.breaks)
}
}else if(x$summary$Submodel[x$summary$Model==model_name][1] == 'BMD_d'){
for(i in 1:length(covar)){
pars <- c('par1[1]',
paste0('par2[',i,']'),
'par3',
paste0('par4[',i,']'))
if(grepl('_LN',model_name)){
temp1 <- c(temp1, exp(DRM(par = model_pars[pars], (10^(log10(seq(ifelse(min(x$data$x) == 0, min(x$data$x[x$data$x != 0])/4, min(x$data$x)), maxDose, 0.01))))/maxDose, x$q, x$shift)))
}else{
temp1 <- c(temp1, DRM(par = model_pars[pars], (10^(log10(seq(ifelse(min(x$data$x) == 0, min(x$data$x[x$data$x != 0])/4, min(x$data$x)), maxDose, 0.01))))/maxDose, x$q, x$shift))
}
}
if(grepl('_LN',model_name)){
dataTemp <- data.frame(x = log10(seq(ifelse(min(x$data$x) == 0, min(x$data$x[x$data$x != 0])/4, min(x$data$x)), maxDose, 0.01)),
y = temp1,
cov = rep(covar, each = length(log10(seq(ifelse(min(x$data$x) == 0, min(x$data$x[x$data$x != 0])/4, min(x$data$x)), maxDose, 0.01)))))
p <- ggplot() + geom_point(data = x$data, aes(x = x2, y = geom.y, colour = cov)) + #, position = position_dodge(width=0.2)) +
geom_line(data = dataTemp, aes(x = x, y = y, colour = cov))          +
geom_point(data = x$data, aes(x = x2, y = geom.y + geom.s, colour = cov, fill = cov), shape = 25) +
geom_point(data = x$data, aes(x = x2, y = geom.y - geom.s, colour = cov, fill = cov), shape = 24) +
# geom_errorbar(data = x$data, mapping = aes(x = x2, ymin = geom.y - geom.s, ymax = geom.y + geom.s, colour = cov),
#               size = 1, width = NA, linetype = 'dotted') + #, position = position_dodge(width=0.2)) +
scale_x_continuous(trans = 'identity', labels = plot.labs, breaks = plot.breaks)
}else{
dataTemp <- data.frame(x = log10(seq(ifelse(min(x$data$x) == 0, min(x$data$x[x$data$x != 0])/4, min(x$data$x)), maxDose, 0.01)),
y = temp1,
cov = rep(covar, each = length(log10(seq(ifelse(min(x$data$x) == 0, min(x$data$x[x$data$x != 0])/4, min(x$data$x)), maxDose, 0.01)))))
p <- ggplot() + geom_point(data = x$data, aes(x = x2, y = y, colour = cov)) +
geom_line(data = dataTemp, aes(x = x, y = y, colour = cov)) +
geom_point(data = x$data, aes(x = x2, y = y + s, colour = cov, fill = cov), shape = 25) +
geom_point(data = x$data, aes(x = x2, y = y - s, colour = cov, fill = cov), shape = 24) +
# geom_errorbar(data = x$data, mapping = aes(x = x2, ymin = y - s, ymax = y + s, colour = cov),
#               size = 1, width = NA, linetype = 'dashed') +
scale_x_continuous(trans = 'identity', labels = plot.labs, breaks = plot.breaks)
}
}else if(x$summary$Submodel[x$summary$Model==model_name][1] == 'all'){
for(i in 1:length(covar)){
pars <- c(paste0('par1[',i,']'),
paste0('par2[',i,']'),
'par3',
paste0('par4[',i,']')
)
if(grepl('_LN',model_name)){
temp2 <- c(temp2, exp(DRM(par = model_pars[pars], (10^(log10(seq(ifelse(min(x$data$x) == 0, min(x$data$x[x$data$x != 0])/4, min(x$data$x)), maxDose, 0.01))))/maxDose, x$q, x$shift)))
}else{
temp2 <- c(temp2, DRM(par = model_pars[pars], (10^(log10(seq(ifelse(min(x$data$x) == 0, min(x$data$x[x$data$x != 0])/4, min(x$data$x)), maxDose, 0.01))))/maxDose, x$q, x$shift))
}
}
if(grepl('_LN',model_name)){
dataTemp <- data.frame(x = log10(seq(ifelse(min(x$data$x) == 0, min(x$data$x[x$data$x != 0])/4, min(x$data$x)), maxDose, 0.01)),
y = temp2,
cov = rep(covar, each = length(log10(seq(ifelse(min(x$data$x) == 0, min(x$data$x[x$data$x != 0])/4, min(x$data$x)), maxDose, 0.01)))))
p <- ggplot() + geom_point(data = x$data, aes(x = x2, y = geom.y, colour = cov)) +
geom_line(data = dataTemp, aes(x = x, y = y, colour = cov)) +
geom_point(data = x$data, aes(x = x2, y = geom.y + geom.s, colour = cov, fill = cov), shape = 25) +
geom_point(data = x$data, aes(x = x2, y = geom.y - geom.s, colour = cov, fill = cov), shape = 24) +
# geom_errorbar(data = x$data, mapping = aes(x = x2, ymin = geom.y - geom.s, ymax = geom.y + geom.s, colour = cov),
#               size = 1, width = NA, linetype = 'dashed') +
scale_x_continuous(trans = 'identity', labels = plot.labs, breaks = plot.breaks)
}else{
dataTemp <- data.frame(x = log10(seq(ifelse(min(x$data$x) == 0, min(x$data$x[x$data$x != 0])/4, min(x$data$x)), maxDose, 0.01)),
y = temp2,
cov = rep(covar, each = length(log10(seq(ifelse(min(x$data$x) == 0, min(x$data$x[x$data$x != 0])/4, min(x$data$x)), maxDose, 0.01)))))
p <- ggplot() + geom_point(data = x$data, aes(x = x2, y = y, colour = cov)) +
geom_line(data = dataTemp, aes(x = x, y = y, colour = cov))+
geom_point(data = x$data, aes(x = x2, y = y + s, colour = cov, fill = cov), shape = 25) +
geom_point(data = x$data, aes(x = x2, y = y - s, colour = cov, fill = cov), shape = 24) +
# geom_errorbar(data = x$data, mapping = aes(x = x2, ymin = y - s, ymax = y + s, colour = cov),
#               size = 1, width = NA, linetype = 'dashed') +
scale_x_continuous(trans = 'identity', labels = plot.labs, breaks = plot.breaks)
}
}else{
if(grepl('_LN',model_name)){
temp3 <- c(temp3, exp(DRM(par = model_pars[c(1,2,9,4)], (10^(log10(seq(ifelse(min(x$data$x) == 0, min(x$data$x[x$data$x != 0])/4, min(x$data$x)), maxDose, 0.01))))/maxDose, x$q, x$shift)))
dataTemp <- data.frame(x = log10(seq(ifelse(min(x$data$x) == 0, min(x$data$x[x$data$x != 0])/4, min(x$data$x)), maxDose, 0.01)), y = temp3)
p <- ggplot() + geom_point(data = x$data, aes(x = x2, y = geom.y, colour = cov)) +
geom_line(data = dataTemp, aes(x = x, y = y)) +
geom_point(data = x$data, aes(x = x2, y = geom.y + geom.s, colour = cov, fill = cov), shape = 25) +
geom_point(data = x$data, aes(x = x2, y = geom.y - geom.s, colour = cov, fill = cov), shape = 24) +
# geom_errorbar(data = x$data, mapping = aes(x = x2, ymin = geom.y - geom.s, ymax = geom.y + geom.s, colour = cov),
#               size = 1, width = NA, linetype = 'dashed') +
scale_x_continuous(trans = 'identity', labels = plot.labs, breaks = plot.breaks)
}else{
temp3 <- c(temp3, DRM(par = model_pars[c(1,2,9,4)], (10^(log10(seq(ifelse(min(x$data$x) == 0, min(x$data$x[x$data$x != 0])/4, min(x$data$x)), maxDose, 0.01))))/maxDose, x$q, x$shift))
dataTemp <- data.frame(x = log10(seq(ifelse(min(x$data$x) == 0, min(x$data$x[x$data$x != 0])/4, min(x$data$x)), maxDose, 0.01)), y = temp3)
p <- ggplot() + geom_point(data = x$data, aes(x = x2, y = y, colour = cov)) +
geom_line(data = dataTemp, aes(x = x, y = y)) +
geom_point(data = x$data, aes(x = x2, y = y + s, colour = cov, fill = cov), shape = 25) +
geom_point(data = x$data, aes(x = x2, y = y - s, colour = cov, fill = cov), shape = 24) +
# geom_errorbar(data = x$data, mapping = aes(x = x2, ymin = y - s, ymax = y + s, colour = cov),
#               size = 1, width = NA, linetype = 'dashed') +
scale_x_continuous(trans = 'identity', labels = plot.labs, breaks = plot.breaks)
}
}
subtit <- paste0(paste0('Best submodel: ', paste0(x$summary$Submodel[x$summary$Model==model_name][1])," ("),
paste0('Weight = ', round(x$weights[model_name], 4)),")")
pp <- p + labs(title = paste0('Fitted model: ', model_name),
subtitle = subtit,
x = 'Dose', y = 'Response', colour = 'Covariate')
}
pp
p + labs(title = paste0('Fitted model: ', model_name),
subtitle = subtit,
x = 'Dose', y = 'Response', colour = 'Covariate', fill = 'Covariate')
source('R/plot_model_fit.R')
basic.plot(FLBMD, 'E4_N', increasing = F)
source('R/plot_model_fit.R')
summ.data <- data.frame(x = data$Dose,
y = data$HepatocyteHypertrophy,
n = data$N,
cov = data$Sex)
summ.data
summ.data
q = 0.1
prior.weights = c(rep(1,4), rep(0,4))
FLBMD <- full.laplace_MA_Q_Cov(summ.data,
sumstats = T,
q = q,
prior.d = 'N11',
extended = T,
ndraws = 30000,
seed = 123,
pvec = c(0.05, 0.5, 0.95),
prior.weights = prior.weights)
FLBMD$MA
FLBMD$summary
basic.plotQ(FLBMD, 'E4_Q')
