data.test <- read.csv(file.path(dataDir,'test_data.csv'), sep = ';')
data.test
summ.data <- data.frame(
x = data.test$Dose,
y = data.test$Mean,
s = data.test$SD,
n = data.test$N,
cov = data.test$group
)
summ.data
q = 0.2
prior.weights = rep(1,16)
# Fit models
FLBMD <- full.laplace_MA_Cov(summ.data,
sumstats = T,
sd = T, # option not used for Quantal data
q = q,
prior.d = 'N11',
extended = F,
ndraws = 30000,
seed = 123,
pvec = c(0.05, 0.5, 0.95),
prior.weights = prior.weights)
library(gamlss)
# Fit models
FLBMD <- full.laplace_MA_Cov(summ.data,
sumstats = T,
sd = T, # option not used for Quantal data
q = q,
prior.d = 'N11',
extended = F,
ndraws = 30000,
seed = 123,
pvec = c(0.05, 0.5, 0.95),
prior.weights = prior.weights)
FLBMD$summary
# Plots
for (i in seq_along(get_models(type = "continuous"))){
basic.plot(FLBMD, model_name = get_models("continuous")[i], increasing = T)
}
load(file.path(dataDir, "das1.rda"))
data.test <- das1$data
ind.data <- data.frame(
x = data.test$Dose,
y = data.test$LDH,
#          s = data.test$SD,
#          n = data.test$N,
cov = data.test$sex
)
ind.data <- ind.data[which(!is.na(ind.data$y)),]
ind.data <- data.frame(
x = data.test$Dose,
y = data.test$LDH,
#          s = data.test$SD,
#          n = data.test$N,
cov = data.test$sex
)
q = 0.05
prior.weights = rep(1,16)
# Fit models TODO: returns an error
FLBMD <- full.laplace_MA_Cov(
data = ind.data,
sumstats = FALSE,
sd = TRUE, # option not used for Quantal data
q = q,
prior.d = 'N11'
)
ind.data <- ind.data[which(!is.na(ind.data$y)),]
q = 0.05
prior.weights = rep(1,16)
# Fit models TODO: returns an error
FLBMD <- full.laplace_MA_Cov(
data = ind.data,
sumstats = FALSE,
sd = TRUE, # option not used for Quantal data
q = q,
prior.d = 'N11'
)
FLBMD$summary
# Plots
for (i in seq_along(get_models(type = "continuous"))){
basic.plot(FLBMD, model_name = get_models("continuous")[i], increasing = T)
}
data <- read.csv(file.path(dataDir, "example_quantal.csv"))
# Each covariate level should be present in each dose group
data.input <- data.frame(
dose = rep(data$dose, 2),
y = rep(data$response, 2),
n = rep(data$size, 2),
covariate = c(rep('Male', 5), rep('Female', 5))
)
q = 0.1
# Fit models TODO: returns an error
modelFit <- full.laplace_MA_Q_Cov(
data = data.input,
q = q
)
modelFit$summary
# Plots
for (i in seq_along(get_models(type = "quantal"))) {
basic.plotQ(modelFit, model_name = get_models(type = "quantal")[i])
}
library('rstantools')
library('usethis')
library('roxygen2')
# Set working directory to the new package directory
setwd('C:\\Users\\lucp9385\\Documents\\GitHub\\BMABMDR')
list.files(all.files=T)
Sys.getenv("BINPREF") # should be "C:/Rtools/mingw64/bin/"
# Sys.setenv(BINPREF = "C:/rtools40/mingw64/bin/;C:/rtools40/mingw32/bin/")
Sys.setenv(BINPREF = "C:/rtools40/mingw64/bin/")
Sys.getenv("PATH")
old_path <- Sys.getenv("PATH")
# new_path <- paste("C:\\Rtools\\usr\\bin", old_path, sep=";")
new_path <- paste(old_path, "C:\\rtools40\\mingw32\\bin;C:\\rtools40\\mingw64\\bin", sep=";")
# # new_path
Sys.setenv(PATH = new_path)
## Compile package and generate the documentation
rstan_config() # recompile stan models
example(source)
try(roxygen2::roxygenize(load_code = sourceDir), silent = TRUE)
# roxygen2::roxygenize(load_code = sourceDir) # generate documentation
pkgbuild::compile_dll()
roxygen2::roxygenize()
library('rstantools')
library('usethis')
library('roxygen2')
# Set working directory to the new package directory
setwd('C:\\Users\\lucp9385\\Documents\\GitHub\\BMABMDR')
list.files(all.files=T)
Sys.getenv("BINPREF") # should be "C:/Rtools/mingw64/bin/"
# Sys.setenv(BINPREF = "C:/rtools40/mingw64/bin/;C:/rtools40/mingw32/bin/")
Sys.setenv(BINPREF = "C:/rtools40/mingw64/bin/")
Sys.getenv("PATH")
old_path <- Sys.getenv("PATH")
# new_path <- paste("C:\\Rtools\\usr\\bin", old_path, sep=";")
new_path <- paste(old_path, "C:\\rtools40\\mingw32\\bin;C:\\rtools40\\mingw64\\bin", sep=";")
# # new_path
Sys.setenv(PATH = new_path)
## Compile package and generate the documentation
rstan_config() # recompile stan models
example(source)
try(roxygen2::roxygenize(load_code = sourceDir), silent = TRUE)
# roxygen2::roxygenize(load_code = sourceDir) # generate documentation
pkgbuild::compile_dll()
roxygen2::roxygenize()
library(gamlss)
library(BMABMDR)
packageVersion('BMABMDR')
dataDir <- '~/GitHub/BMABMDR/tests/'
data.test <- read.csv(file.path(dataDir,'test_data.csv'), sep = ';')
summ.data <- data.frame(
x = data.test$Dose,
y = data.test$Mean,
s = data.test$SD,
n = data.test$N,
cov = data.test$group
)
q = 0.2
prior.weights = rep(1,16)
# Fit models
FLBMD <- full.laplace_MA_Cov(summ.data,
sumstats = T,
sd = T, # option not used for Quantal data
q = q,
prior.d = 'N11',
extended = F,
ndraws = 30000,
seed = 123,
pvec = c(0.05, 0.5, 0.95),
prior.weights = prior.weights)
FLBMD$summary
# Plots
for (i in seq_along(get_models(type = "continuous"))){
basic.plot(FLBMD, model_name = get_models("continuous")[i], increasing = T)
}
load(file.path(dataDir, "das1.rda"))
data.test <- das1$data
ind.data <- data.frame(
x = data.test$Dose,
y = data.test$LDH,
#          s = data.test$SD,
#          n = data.test$N,
cov = data.test$sex
)
ind.data <- ind.data[which(!is.na(ind.data$y)),]
q = 0.05
prior.weights = rep(1,16)
# Fit models TODO: returns an error
FLBMD <- full.laplace_MA_Cov(
data = ind.data,
sumstats = FALSE,
sd = TRUE, # option not used for Quantal data
q = q,
prior.d = 'N11'
)
FLBMD$summary
# Plots
for (i in seq_along(get_models(type = "continuous"))){
basic.plot(FLBMD, model_name = get_models("continuous")[i], increasing = T)
}
data <- read.csv(file.path(dataDir, "example_quantal.csv"))
# Each covariate level should be present in each dose group
data.input <- data.frame(
dose = rep(data$dose, 2),
y = rep(data$response, 2),
n = rep(data$size, 2),
covariate = c(rep('Male', 5), rep('Female', 5))
)
q = 0.1
# Fit models TODO: returns an error
modelFit <- full.laplace_MA_Q_Cov(
data = data.input,
q = q
)
modelFit$summary
# Plots
for (i in seq_along(get_models(type = "quantal"))) {
basic.plotQ(modelFit, model_name = get_models(type = "quantal")[i])
}
modelFit$q
FLBMD$q
# roxygen2::roxygenize(load_code = sourceDir) # generate documentation
pkgbuild::compile_dll()
roxygen2::roxygenize()
# Fit models TODO: returns an error
modelFit <- full.laplace_MA_Q_Cov(
data = data.input,
q = q
)
modelFit$q
# Plots
for (i in seq_along(get_models(type = "quantal"))) {
basic.plotQ(modelFit, model_name = get_models(type = "quantal")[i])
}
library('rstantools')
library('usethis')
library('roxygen2')
# Set working directory to the new package directory
setwd('C:\\Users\\lucp9385\\Documents\\GitHub\\BMABMDR')
list.files(all.files=T)
Sys.getenv("BINPREF") # should be "C:/Rtools/mingw64/bin/"
# Sys.setenv(BINPREF = "C:/rtools40/mingw64/bin/;C:/rtools40/mingw32/bin/")
Sys.setenv(BINPREF = "C:/rtools40/mingw64/bin/")
Sys.getenv("PATH")
old_path <- Sys.getenv("PATH")
# new_path <- paste("C:\\Rtools\\usr\\bin", old_path, sep=";")
new_path <- paste(old_path, "C:\\rtools40\\mingw32\\bin;C:\\rtools40\\mingw64\\bin", sep=";")
# # new_path
Sys.setenv(PATH = new_path)
## Compile package and generate the documentation
rstan_config() # recompile stan models
example(source)
try(roxygen2::roxygenize(load_code = sourceDir), silent = TRUE)
# roxygen2::roxygenize(load_code = sourceDir) # generate documentation
pkgbuild::compile_dll()
roxygen2::roxygenize()
library(BMABMDR)
packageVersion('BMABMDR')
mSM_Q
stanmodels$mSM_Q
# roxygen2::roxygenize(load_code = sourceDir) # generate documentation
pkgbuild::compile_dll()
roxygen2::roxygenize()
packageVersion('BMABMDR')
dataDir <- '~/GitHub/BMABMDR/tests/'
data.test <- read.csv(file.path(dataDir,'test_data.csv'), sep = ';')
summ.data <- data.frame(
x = data.test$Dose,
y = data.test$Mean,
s = data.test$SD,
n = data.test$N,
cov = data.test$group
)
q = 0.2
prior.weights = rep(1,16)
# Fit models
FLBMD <- full.laplace_MA_Cov(summ.data,
sumstats = T,
sd = T, # option not used for Quantal data
q = q,
prior.d = 'N11',
extended = F,
ndraws = 30000,
seed = 123,
pvec = c(0.05, 0.5, 0.95),
prior.weights = prior.weights)
library(gamlss)
# Fit models
FLBMD <- full.laplace_MA_Cov(summ.data,
sumstats = T,
sd = T, # option not used for Quantal data
q = q,
prior.d = 'N11',
extended = F,
ndraws = 30000,
seed = 123,
pvec = c(0.05, 0.5, 0.95),
prior.weights = prior.weights)
FLBMD$summary
# Plots
for (i in seq_along(get_models(type = "continuous"))){
basic.plot(FLBMD, model_name = get_models("continuous")[i], increasing = T)
}
load(file.path(dataDir, "das1.rda"))
data.test <- das1$data
ind.data <- data.frame(
x = data.test$Dose,
y = data.test$LDH,
#          s = data.test$SD,
#          n = data.test$N,
cov = data.test$sex
)
ind.data <- ind.data[which(!is.na(ind.data$y)),]
q = 0.05
prior.weights = rep(1,16)
# Fit models TODO: returns an error
FLBMD <- full.laplace_MA_Cov(
data = ind.data,
sumstats = FALSE,
sd = TRUE, # option not used for Quantal data
q = q,
prior.d = 'N11'
)
FLBMD$summary
# Plots
for (i in seq_along(get_models(type = "continuous"))){
basic.plot(FLBMD, model_name = get_models("continuous")[i], increasing = T)
}
data <- read.csv(file.path(dataDir, "example_quantal.csv"))
# Each covariate level should be present in each dose group
data.input <- data.frame(
dose = rep(data$dose, 2),
y = rep(data$response, 2),
n = rep(data$size, 2),
covariate = c(rep('Male', 5), rep('Female', 5))
)
q = 0.1
# Fit models TODO: returns an error
modelFit <- full.laplace_MA_Q_Cov(
data = data.input,
q = q
)
modelFit$summary
# Plots
for (i in seq_along(get_models(type = "quantal"))) {
basic.plotQ(modelFit, model_name = get_models(type = "quantal")[i])
}
# Fit without covariate
data.input.Q <- PREP_DATA_QA(data = data.input, q = q, sumstats = T)
modelFit <- full.laplaceQ_MA(data.input.Q, prior.weights = rep(1,8), pvec = c(0.05,0.5,0.95))
modelFit$MA
pt <- plot.BMADRQ(modelFit, weight_type = 'LP', all = F, title = '')
pt$weights
pt$weights; pt$model_fit
data.input$y[1:5] = data.input$y[1:5]+2
# Fit without covariate
data.input.Q <- PREP_DATA_QA(data = data.input, q = q, sumstats = T)
modelFit <- full.laplaceQ_MA(data.input.Q, prior.weights = rep(1,8), pvec = c(0.05,0.5,0.95))
modelFit$MA
pt <- plot.BMADRQ(modelFit, weight_type = 'LP', all = F, title = '')
pt$weights
pt$model_fit
data.input
data.input$y/data.input$n
library('rstantools')
library('usethis')
library('roxygen2')
# Set working directory to the new package directory
setwd('C:\\Users\\lucp9385\\Documents\\GitHub\\BMABMDR')
list.files(all.files=T)
Sys.getenv("BINPREF") # should be "C:/Rtools/mingw64/bin/"
# Sys.setenv(BINPREF = "C:/rtools40/mingw64/bin/;C:/rtools40/mingw32/bin/")
Sys.setenv(BINPREF = "C:/rtools40/mingw64/bin/")
Sys.getenv("PATH")
old_path <- Sys.getenv("PATH")
# new_path <- paste("C:\\Rtools\\usr\\bin", old_path, sep=";")
new_path <- paste(old_path, "C:\\rtools40\\mingw32\\bin;C:\\rtools40\\mingw64\\bin", sep=";")
# # new_path
Sys.setenv(PATH = new_path)
## Compile package and generate the documentation
rstan_config() # recompile stan models
example(source)
try(roxygen2::roxygenize(load_code = sourceDir), silent = TRUE)
# roxygen2::roxygenize(load_code = sourceDir) # generate documentation
pkgbuild::compile_dll()
roxygen2::roxygenize()
## Compile package and generate the documentation
rstan_config() # recompile stan models
example(source)
try(roxygen2::roxygenize(load_code = sourceDir), silent = TRUE)
# roxygen2::roxygenize(load_code = sourceDir) # generate documentation
pkgbuild::compile_dll()
roxygen2::roxygenize()
library(BMABMDR)
library(gamlss)
packageVersion('BMABMDR')
n=100; dp=2; doses=c(rep(0,n),rep(c(0,dp^(-4),dp^(-3),dp^(-2),dp^(-1),1),n))
simsigma=1; q=0.1
pvec=c(0.05,0.5,0.95)
BMD.true=0.12 # flat
min.resp = 5.3
ctrue = 0.65
max.resp = min.resp*ctrue
par1=c((min.resp),(BMD.true),ctrue,1) # N data
set.seed(2)
y1=rnorm(rep(1,length(doses)),
mean=DRM.E4_ND(par=par1,
x=doses,q=q),
sd=simsigma)
min.resp = 5.3 # 10.6
max.resp = min.resp*ctrue
BMD.true = 0.08
simsigma = 1 #0.8
par2=c((min.resp),(BMD.true),ctrue,1.5) # N data
y2=rnorm(rep(1,length(doses)),
mean=DRM.E4_ND(par=par2,
x=doses,q=q),
sd=simsigma)
par(mfrow = c(1,1))
plot(doses, y1, xlab = 'Dose', ylab = 'Response', main = 'True model = E4_N',
ylim = c(min(y1,y2)-0.5, max(y1,y2)+0.5))
points(doses, y2, pch = 2, col = 2)
# preparing the summary statistics
dose.a1=sort(unique(doses)); N1=length(dose.a1)
mean.a1=rep(NA,N1); sd.a1=rep(NA,N1); n.a1=rep(NA,N1); sex1=rep(NA,N1)
for (iu in (1:N1)){
mean.a1[iu]=mean(y1[doses==dose.a1[iu]])
sd.a1[iu]=sd(y1[doses==dose.a1[iu]])
n.a1[iu]=sum(doses==dose.a1[iu])
sex1[iu]=1
}
dose.a2=sort(unique(doses)); N2=length(dose.a2)
mean.a2=rep(NA,N2); sd.a2=rep(NA,N2); n.a2=rep(NA,N2); sex2=rep(NA,N2)
for (iu in (1:N2)){
mean.a2[iu]=mean(y2[doses==dose.a2[iu]])
sd.a2[iu]=sd(y2[doses==dose.a2[iu]])
n.a2[iu]=sum(doses==dose.a2[iu])
sex2[iu]=2
}
summ.data = data.frame(x = c(dose.a1, dose.a2), y = c(mean.a1, mean.a2), s = c(sd.a1, sd.a2),
n = c(n.a1, n.a2), sex = c(sex1, sex2))
lines(summ.data$x[summ.data$sex==1], summ.data$y[summ.data$sex==1], lty = 2, lwd = 2)
lines(summ.data$x[summ.data$sex==2], summ.data$y[summ.data$sex==2], col = 2, lwd = 2)
# legend('topright', c('a = 5.3, BMD = 0.12, d = 1, sigma = 1', 'a = 10.6, BMD = 0.08, d = 1.5, sigma = 0.8'), col = c(1,2), pch = c(1,2), bty = 'n')
legend('topright', c('a = 5.3, BMD = 0.12, d = 1, sigma = 1', 'a = 5.3, BMD = 0.08, d = 1.5, sigma = 1'), col = c(1,2), pch = c(1,2), bty = 'n')
prior.weights = rep(1,16)
FLBMD <- full.laplace_MA_Cov(
data = summ.data,
sumstats = TRUE,
sd = TRUE, # option not used for Quantal data
q = q,
prior.d = 'N11'
)
FLBMD$MA
FLBMD$summary
# Plots
for (i in seq_along(get_models(type = "continuous"))){
basic.plot(FLBMD, model_name = get_models("continuous")[i], increasing = F)
}
dataDir <- '~/GitHub/BMABMDR/tests/'
load(file.path(dataDir, "das1.rda"))
data.test <- das1$data
ind.data <- data.frame(
x = data.test$Dose,
y = data.test$LDH,
#          s = data.test$SD,
#          n = data.test$N,
cov = data.test$sex
)
ind.data <- ind.data[which(!is.na(ind.data$y)),]
q = 0.05
prior.weights = rep(1,16)
FLBMD <- full.laplace_MA_Cov(
data = ind.data,
sumstats = FALSE,
sd = TRUE, # option not used for Quantal data
q = q,
prior.d = 'N11'
)
FLBMD$MA
FLBMD$summary
# Plots
for (i in seq_along(get_models(type = "continuous"))){
basic.plot(FLBMD, model_name = get_models("continuous")[i], increasing = T)
}
data <- read.csv(file.path(dataDir, "example_quantal.csv"))
# Each covariate level should be present in each dose group
data.input <- data.frame(
dose = rep(data$dose, 2),
y = rep(data$response, 2),
n = rep(data$size, 2),
covariate = c(rep('Male', 5), rep('Female', 5))
)
q = 0.1
anydoseresponseQ(data.input$dose, data.input$y, data.input$n)
# Fit without covariate
data.input.Q <- PREP_DATA_QA(data = data.input, q = q, sumstats = T)
modelFit <- full.laplaceQ_MA(data.input.Q, prior.weights = rep(1,8), pvec = c(0.05,0.5,0.95))
modelFit$MA
modelFit$summary
# Fit with covariate
modelFit <- full.laplace_MA_Q_Cov(
data = data.input,
q = q
)
modelFit$summary
modelFit$MA
# Plots --> MODEL FIT?? covariate effects not reflected in fit
for (i in seq_along(get_models(type = "quantal"))) {
basic.plotQ(modelFit, model_name = get_models(type = "quantal")[i])
}
