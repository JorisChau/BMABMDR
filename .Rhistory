)
data_NCOV_dBMD <- PREP_DATA_NCOV(
data = data,
sumstats = sumstats,
sd = sd,
q = q,
prior.d = prior.d,
extended = extended,
covariate = 'BMD_d'
)
data_N_noCOV <- PREP_DATA_N(data = data,
sumstats = sumstats,
sd = sd,
q = q,
prior.d = prior.d,
extended = extended)
data_N_noCOV
data_N_noCOV$data
data_N_noCOV$data$x*data_N_noCOV$data$maxD
data_N_noCOV$m
data_N_noCOV$data$m
summ.data
source('./R/fun_Data.R')
data_LNCOV_all <- PREP_DATA_LNCOV(
data = data,
sumstats = sumstats,
sd = sd,
q = q,
prior.d = prior.d,
extended = extended,
covariate = 'all'
)
data_LNCOV_asigma2 <- PREP_DATA_LNCOV(
data = data,
sumstats = sumstats,
sd = sd,
q = q,
prior.d = prior.d,
extended = extended,
covariate = 'a_sigma2'
)
data_LNCOV_dBMD <- PREP_DATA_LNCOV(
data = data,
sumstats = sumstats,
sd = sd,
q = q,
prior.d = prior.d,
extended = extended,
covariate = 'BMD_d'
)
data_LN_noCOV <- PREP_DATA_LN(data = data,
sumstats = sumstats,
sd = sd,
q = q,
prior.d = prior.d,
extended = extended)
summ.data
q = 0.05
prior.weights = rep(1,16)
FLBMD <- full.laplace_MA_Cov(summ.data,
sumstats = T,
sd = T, # option not used for Quantal data
q = q,
prior.d = 'N11',
extended = T,
ndraws = 30000,
seed = 123,
pvec = c(0.05, 0.5, 0.95),
prior.weights = prior.weights)
prior.weights = c(rep(1,8), rep(0,8))
FLBMD <- full.laplace_MA_Cov(summ.data,
sumstats = T,
sd = T, # option not used for Quantal data
q = q,
prior.d = 'N11',
extended = T,
ndraws = 30000,
seed = 123,
pvec = c(0.05, 0.5, 0.95),
prior.weights = prior.weights)
data_noCOV$data
summ.data
data_N_noCOV$data
data_N <- PREP_DATA_N(summ.data)
data_N <- PREP_DATA_N(summ.data, q = q)
data_LN <- PREP_DATA_LN(summ.data, q = q)
FLBMD_nocov <- full.laplace_MA(data_N, data_LN)
FLBMD_nocov$dataN
FLBMD_nocov$dataN$dose2 = FLBMD_nocov$dataN$dose * FLBMD_nocov$max.dose
FLBMD_nocov
FLBMD_nocov$dataN
summ.data
pFLBMD_nocov <- plot.BMADR(FLBMD_nocov, type = 'decreasing', weight_type = 'LP', all = F, title = '')
pFLBMD_nocov$model_fit_N
pFLBMD_nocov$model_fit_LN
pFLBMD_nocov$MA_fit
FLBMD <- full.laplace_MA_Cov(summ.data,
sumstats = T,
sd = T, # option not used for Quantal data
q = q,
prior.d = 'N11',
extended = T,
ndraws = 30000,
seed = 123,
pvec = c(0.05, 0.5, 0.95),
prior.weights = prior.weights)
# prior.weights = c(rep(1,8), rep(0,8))
prior.weights = c(rep(1,4), rep(0,12))
FLBMD <- full.laplace_MA_Cov(summ.data,
sumstats = T,
sd = T, # option not used for Quantal data
q = q,
prior.d = 'N11',
extended = T,
ndraws = 30000,
seed = 123,
pvec = c(0.05, 0.5, 0.95),
prior.weights = prior.weights)
FLBMD$MA
FLBMD$summary
basic.plot(FLBMD, 'E4_N', increasing = F)
basic.plot(FLBMD, 'H4_LN', increasing = F)
basic.plot(FLBMD, 'H4_LN', increasing = F)
FLBMD$data
x = FLBMD
model_name = 'E4_N'
increasing = T
x$data
covar <- as.factor(unique(x$data[,5]))
temp <- temp1 <- temp2 <- temp3 <- NULL
x$data$geom.y <- NtoLN(x$data$y, sqrt(x$data$s2))[1:dim(x$data)[1]]
x$data$geom.s <- NtoLN(x$data$y, sqrt(x$data$s2))[(dim(x$data)[1]+1):(2*dim(x$data)[1])]
maxDose <- x$maxDose
model_pars <- get('x')[[paste0('par',model_name)]]
if(increasing == TRUE){
DRM <- get(paste0('DRM.', model_name, 'I'))
}  else{
DRM <- get(paste0('DRM.', model_name, 'D'))
}
for(i in 1:length(covar)){
pars <- c(paste0('par1[',i,']'),
paste0('par2[',i,']'),
'par3',
paste0('par4[',i,']')
)
if(grepl('_LN',model_name)){
temp2 <- c(temp2, exp(DRM(par = model_pars[pars], seq(0,maxDose,0.01)/maxDose, x$q, x$shift)))
}else{
temp2 <- c(temp2, DRM(par = model_pars[pars], seq(0,maxDose,0.01)/maxDose, x$q, x$shift))
}
}
temp2
x$data
source('./R/fun_Laplace.R')
FLBMD <- full.laplace_MA_Cov(summ.data,
sumstats = T,
sd = T, # option not used for Quantal data
q = q,
prior.d = 'N11',
extended = T,
ndraws = 30000,
seed = 123,
pvec = c(0.05, 0.5, 0.95),
prior.weights = prior.weights)
FLBMD$MA
FLBMD$summary
basic.plot(FLBMD, 'E4_N', increasing = F)
x = FLBMD
covar <- as.factor(unique(x$data[,5]))
temp <- temp1 <- temp2 <- temp3 <- NULL
x$data$geom.y <- NtoLN(x$data$y, sqrt(x$data$s2))[1:dim(x$data)[1]]
x$data$geom.s <- NtoLN(x$data$y, sqrt(x$data$s2))[(dim(x$data)[1]+1):(2*dim(x$data)[1])]
maxDose <- x$maxDose
x$data
source('./R/fun_Data.R')
source('./R/fun_Laplace.R')
summ.data <- data.frame(x = data$Dose,
y = data$MeanBW,
s = data$SdBW,
n = data$N,
cov = data$Sex)
summ.data
q = 0.05
# prior.weights = c(rep(1,8), rep(0,8))
prior.weights = c(rep(1,4), rep(0,12))
FLBMD <- full.laplace_MA_Cov(summ.data,
sumstats = T,
sd = T, # option not used for Quantal data
q = q,
prior.d = 'N11',
extended = T,
ndraws = 30000,
seed = 123,
pvec = c(0.05, 0.5, 0.95),
prior.weights = prior.weights)
summ.data
data <- read.csv('~/BBMD/FINAL CODE/RatStudy.csv', header = T)
data
summ.data <- data.frame(x = data$Dose,
y = data$MeanBW,
s = data$SdBW,
n = data$N,
cov = data$Sex)
summ.data
q = 0.05
# prior.weights = c(rep(1,8), rep(0,8))
prior.weights = c(rep(1,4), rep(0,12))
FLBMD <- full.laplace_MA_Cov(summ.data,
sumstats = T,
sd = T, # option not used for Quantal data
q = q,
prior.d = 'N11',
extended = T,
ndraws = 30000,
seed = 123,
pvec = c(0.05, 0.5, 0.95),
prior.weights = prior.weights)
FLBMD$MA
FLBMD$summary
basic.plot(FLBMD, 'E4_N', increasing = F)
x = FLBMD
covar <- as.factor(unique(x$data[,5]))
temp <- temp1 <- temp2 <- temp3 <- NULL
x$data$geom.y <- NtoLN(x$data$y, sqrt(x$data$s2))[1:dim(x$data)[1]]
x$data$geom.s <- NtoLN(x$data$y, sqrt(x$data$s2))[(dim(x$data)[1]+1):(2*dim(x$data)[1])]
x$data
covar <- as.factor(unique(x$data[,5]))
temp <- temp1 <- temp2 <- temp3 <- NULL
x$data$geom.y <- NtoLN(x$data$y, x$data$s2)[1:dim(x$data)[1]]
x$data$geom.s <- NtoLN(x$data$y, x$data$s2)[(dim(x$data)[1]+1):(2*dim(x$data)[1])]
maxDose <- x$maxDose
model_pars <- get('x')[[paste0('par',model_name)]]
if(increasing == TRUE){
DRM <- get(paste0('DRM.', model_name, 'I'))
}  else{
DRM <- get(paste0('DRM.', model_name, 'D'))
}
for(i in 1:length(covar)){
pars <- c(paste0('par1[',i,']'),
paste0('par2[',i,']'),
'par3',
paste0('par4[',i,']')
)
if(grepl('_LN',model_name)){
temp2 <- c(temp2, exp(DRM(par = model_pars[pars], seq(0,maxDose,0.01)/maxDose, x$q, x$shift)))
}else{
temp2 <- c(temp2, DRM(par = model_pars[pars], seq(0,maxDose,0.01)/maxDose, x$q, x$shift))
}
}
dataTemp <- data.frame(x = seq(0,maxDose,0.01), y = temp2, cov = rep(covar, each = length(seq(0,maxDose,0.01))))
p <- ggplot() + geom_point(data = x$data, aes(x = x*maxDose, y = y, colour = cov)) +
geom_line(data = dataTemp, aes(x = x, y = y, colour = cov))+
geom_errorbar(data = x$data, mapping = aes(x = x*maxDose, ymin = y - sqrt(s2), ymax = geom.y + sqrt(s2), colour = cov),
size = 1, width = NA, linetype = 'dotted')
p
p <- ggplot() + geom_point(data = x$data, aes(x = x, y = y, colour = cov)) +
geom_line(data = dataTemp, aes(x = x, y = y, colour = cov))+
geom_errorbar(data = x$data, mapping = aes(x = x, ymin = y - sqrt(s2), ymax = geom.y + sqrt(s2), colour = cov),
size = 1, width = NA, linetype = 'dotted')
p
DRM
source('./R/plot_model_fit.R')
basic.plot(FLBMD, 'E4_N', increasing = F)
# prior.weights = c(rep(1,8), rep(0,8))
prior.weights = c(rep(1,4), rep(0,4), rep(1,4), rep(0,4))
FLBMD <- full.laplace_MA_Cov(summ.data,
sumstats = T,
sd = T, # option not used for Quantal data
q = q,
prior.d = 'N11',
extended = T,
ndraws = 30000,
seed = 123,
pvec = c(0.05, 0.5, 0.95),
prior.weights = prior.weights)
warnings()
FLBMD$MA
FLBMD$summary
basic.plot(FLBMD, 'E4_N', increasing = F)
basic.plot(FLBMD, 'H4_LN', increasing = F)
x = FLBMD
model_name = 'H4_LN'
covar <- as.factor(unique(x$data[,5]))
temp <- temp1 <- temp2 <- temp3 <- NULL
x$data$geom.y <- NtoLN(x$data$y, x$data$s2)[1:dim(x$data)[1]]
x$data$geom.s <- NtoLN(x$data$y, x$data$s2)[(dim(x$data)[1]+1):(2*dim(x$data)[1])]
maxDose <- x$maxDose
model_pars <- get('x')[[paste0('par',model_name)]]
if(increasing == TRUE){
DRM <- get(paste0('DRM.', model_name, 'I'))
}  else{
DRM <- get(paste0('DRM.', model_name, 'D'))
}
for(i in 1:length(covar)){
pars <- c(paste0('par1[',i,']'),
paste0('par2[',i,']'),
'par3',
paste0('par4[',i,']')
)
if(grepl('_LN',model_name)){
temp2 <- c(temp2, exp(DRM(par = model_pars[pars], seq(0,maxDose,0.01)/maxDose, x$q, x$shift)))
}else{
temp2 <- c(temp2, DRM(par = model_pars[pars], seq(0,maxDose,0.01)/maxDose, x$q, x$shift))
}
}
dataTemp <- data.frame(x = seq(0,maxDose,0.01), y = temp2, cov = rep(covar, each = length(seq(0,maxDose,0.01))))
geom.y
x$data$geom.y
NtoLN(x$data$y, x$data$s2)[1:dim(x$data)[1]]
x$data
source('./R/plot_model_fit.R')
basic.plot(FLBMD, 'E4_N', increasing = F)
basic.plot(FLBMD, 'H4_LN', increasing = F)
covar <- as.factor(unique(x$data[,5]))
temp <- temp1 <- temp2 <- temp3 <- NULL
x$data$geom.y <- NtoLN(x$data$y, x$data$s)[1:dim(x$data)[1]]
x$data$geom.s <- NtoLN(x$data$y, x$data$s)[(dim(x$data)[1]+1):(2*dim(x$data)[1])]
maxDose <- x$maxDose
x$data
model_pars <- get('x')[[paste0('par',model_name)]]
if(increasing == TRUE){
DRM <- get(paste0('DRM.', model_name, 'I'))
}  else{
DRM <- get(paste0('DRM.', model_name, 'D'))
}
for(i in 1:length(covar)){
pars <- c(paste0('par1[',i,']'),
paste0('par2[',i,']'),
'par3',
paste0('par4[',i,']')
)
if(grepl('_LN',model_name)){
temp2 <- c(temp2, exp(DRM(par = model_pars[pars], seq(0,maxDose,0.01)/maxDose, x$q, x$shift)))
}else{
temp2 <- c(temp2, DRM(par = model_pars[pars], seq(0,maxDose,0.01)/maxDose, x$q, x$shift))
}
}
dataTemp <- data.frame(x = seq(0,maxDose,0.01), y = temp2, cov = rep(covar, each = length(seq(0,maxDose,0.01))))
p <- ggplot() + geom_point(data = x$data, aes(x = x, y = geom.y, colour = cov)) +
geom_line(data = dataTemp, aes(x = x, y = y, colour = cov))          +
geom_errorbar(data = x$data, mapping = aes(x = x, ymin = geom.y - geom.s, ymax = geom.y + geom.s, colour = cov),
size = 1, width = NA, linetype = 'dotted')
p
x$data$geom.y - x$data$geom.s
x$data$geom.y + x$data$geom.s
source('./R/plot_model_fit.R')
basic.plot(FLBMD, 'E4_N', increasing = F)
basic.plot(FLBMD, 'H4_LN', increasing = F)
dataTemp <- data.frame(x = seq(0,maxDose,0.01), y = temp2, cov = rep(covar, each = length(seq(0,maxDose,0.01))))
p <- ggplot() + geom_point(data = x$data, aes(x = x, y = geom.y, colour = cov)) +
geom_line(data = dataTemp, aes(x = x, y = y, colour = cov))          +
geom_errorbar(data = x$data, mapping = aes(x = x, ymin = geom.y - geom.s, ymax = geom.y + geom.s, colour = cov),
size = 1, width = NA, linetype = 'dotted')
p
x = FLBMD
covar <- as.factor(unique(x$data[,5]))
temp <- temp1 <- temp2 <- temp3 <- NULL
x$data$geom.y <- NtoLN(x$data$y, x$data$s)[1:dim(x$data)[1]]
x$data$geom.s <- NtoLN(x$data$y, x$data$s)[(dim(x$data)[1]+1):(2*dim(x$data)[1])]
maxDose <- x$maxDose
x$data
model_pars <- get('x')[[paste0('par',model_name)]]
if(increasing == TRUE){
DRM <- get(paste0('DRM.', model_name, 'I'))
}  else{
DRM <- get(paste0('DRM.', model_name, 'D'))
}
model_name
covar
for(i in 1:length(covar)){
pars <- c(paste0('par1[',i,']'),
paste0('par2[',i,']'),
'par3',
paste0('par4[',i,']')
)
if(grepl('_LN',model_name)){
temp2 <- c(temp2, exp(DRM(par = model_pars[pars], seq(0,maxDose,0.01)/maxDose, x$q, x$shift)))
}else{
temp2 <- c(temp2, DRM(par = model_pars[pars], seq(0,maxDose,0.01)/maxDose, x$q, x$shift))
}
}
dataTemp <- data.frame(x = seq(0,maxDose,0.01), y = temp2, cov = rep(covar, each = length(seq(0,maxDose,0.01))))
p <- ggplot() + geom_point(data = x$data, aes(x = x, y = geom.y, colour = cov)) +
geom_line(data = dataTemp, aes(x = x, y = y, colour = cov))          +
geom_errorbar(data = x$data, mapping = aes(x = x, ymin = geom.y - geom.s, ymax = geom.y + geom.s, colour = cov),
size = 1, width = NA, linetype = 'dotted')
p
source('./R/plot_model_fit.R')
FLBMD <- full.laplace_MA_Cov(summ.data,
sumstats = T,
sd = T, # option not used for Quantal data
q = q,
prior.d = 'N11',
extended = T,
ndraws = 30000,
seed = 123,
pvec = c(0.05, 0.5, 0.95),
prior.weights = prior.weights)
FLBMD$MA
FLBMD$summary
basic.plot(FLBMD, 'E4_N', increasing = F)
basic.plot(FLBMD, 'H4_LN', increasing = F)
x = FLBMD
increasing
increasing = F
covar <- as.factor(unique(x$data[,5]))
temp <- temp1 <- temp2 <- temp3 <- NULL
x$data$geom.y <- NtoLN(x$data$y, x$data$s)[1:dim(x$data)[1]]
x$data$geom.s <- NtoLN(x$data$y, x$data$s)[(dim(x$data)[1]+1):(2*dim(x$data)[1])]
maxDose <- x$maxDose
model_pars <- get('x')[[paste0('par',model_name)]]
if(increasing == TRUE){
DRM <- get(paste0('DRM.', model_name, 'I'))
}  else{
DRM <- get(paste0('DRM.', model_name, 'D'))
}
for(i in 1:length(covar)){
pars <- c(paste0('par1[',i,']'),
paste0('par2[',i,']'),
'par3',
paste0('par4[',i,']')
)
if(grepl('_LN',model_name)){
temp2 <- c(temp2, exp(DRM(par = model_pars[pars], seq(0,maxDose,0.01)/maxDose, x$q, x$shift)))
}else{
temp2 <- c(temp2, DRM(par = model_pars[pars], seq(0,maxDose,0.01)/maxDose, x$q, x$shift))
}
}
dataTemp <- data.frame(x = seq(0,maxDose,0.01), y = temp2, cov = rep(covar, each = length(seq(0,maxDose,0.01))))
p <- ggplot() + geom_point(data = x$data, aes(x = x, y = geom.y, colour = cov)) +
geom_line(data = dataTemp, aes(x = x, y = y, colour = cov))          +
geom_errorbar(data = x$data, mapping = aes(x = x, ymin = geom.y - geom.s, ymax = geom.y + geom.s, colour = cov),
size = 1, width = NA, linetype = 'dotted')
p
x$data$y - x$data$s
x$data$geom.y - x$data$geom.s
p + geom_vline(xintercept = 303.8219)
p + geom_hline(yintercept = 303.8219)
# prior.weights = c(rep(1,8), rep(0,8))
prior.weights = c(rep(1,6), rep(0,2), rep(1,6), rep(0,2))
FLBMD <- full.laplace_MA_Cov(summ.data,
sumstats = T,
sd = T, # option not used for Quantal data
q = q,
prior.d = 'N11',
extended = T,
ndraws = 30000,
seed = 123,
pvec = c(0.05, 0.5, 0.95),
prior.weights = prior.weights)
FLBMD$MA
FLBMD$summary
basic.plot(FLBMD, 'E4_N', increasing = F)
basic.plot(FLBMD, 'H4_LN', increasing = F)
basic.plot(FLBMD, 'LN4_N', increasing = F)
basic.plot(FLBMD, 'E4_LN', increasing = F)
# prior.weights = c(rep(1,8), rep(0,8))
prior.weights = c(rep(1,6), rep(1,2), rep(1,6), rep(0,2))
FLBMD <- full.laplace_MA_Cov(summ.data,
sumstats = T,
sd = T, # option not used for Quantal data
q = q,
prior.d = 'N11',
extended = T,
ndraws = 30000,
seed = 123,
pvec = c(0.05, 0.5, 0.95),
prior.weights = prior.weights)
# prior.weights = c(rep(1,8), rep(0,8))
prior.weights = c(rep(1,6), rep(0,2), rep(1,6), rep(1,2))
FLBMD <- full.laplace_MA_Cov(summ.data,
sumstats = T,
sd = T, # option not used for Quantal data
q = q,
prior.d = 'N11',
extended = T,
ndraws = 30000,
seed = 123,
pvec = c(0.05, 0.5, 0.95),
prior.weights = prior.weights)
FLBMD$MA
FLBMD$summary
basic.plot(FLBMD, 'LN4_N', increasing = F)
basic.plot(FLBMD, 'E4_LN', increasing = F)
basic.plot(FLBMD, 'P4_LN', increasing = F)
basic.plot(FLBMD, 'L4_LN', increasing = F)
# prior.weights = c(rep(1,8), rep(0,8))
prior.weights = c(rep(1,7), rep(0,1), rep(1,6), rep(1,2))
FLBMD <- full.laplace_MA_Cov(summ.data,
sumstats = T,
sd = T, # option not used for Quantal data
q = q,
prior.d = 'N11',
extended = T,
ndraws = 30000,
seed = 123,
pvec = c(0.05, 0.5, 0.95),
prior.weights = prior.weights)
FLBMD$MA
FLBMD$summary
basic.plot(FLBMD, 'P4_N', increasing = F)
prior.weights = c(rep(1,8), rep(0,8))
FLBMD <- full.laplace_MA_Cov(summ.data,
sumstats = T,
sd = T, # option not used for Quantal data
q = q,
prior.d = 'N11',
extended = T,
ndraws = 30000,
seed = 123,
pvec = c(0.05, 0.5, 0.95),
prior.weights = prior.weights)
